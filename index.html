<!DOCTYPE html>
<html>
<head>
    <title>Ntuconnect</title>
    <script>
        const API_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL';
        let currentUser = null;

        async function login() {
            const email = document.getElementById('email').value;
            const name = document.getElementById('name').value;
            if (!email) return;
            // Store user in localStorage
            currentUser = { email, name };
            localStorage.setItem('ntuconnect_user', JSON.stringify(currentUser));
            loadFeed();
        }

        async function loadFeed() {
            if (!currentUser) {
                const stored = localStorage.getItem('ntuconnect_user');
                if (stored) currentUser = JSON.parse(stored);
                else return;
            }
            const response = await fetch(`${API_URL}?action=getPosts`);
            const data = await response.json();
            displayPosts(data.posts);
        }

        function displayPosts(posts) {
            const container = document.getElementById('feed');
            container.innerHTML = '';
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `
                    <h3>${post.title || 'Goodwill'}</h3>
                    <p>${post.content}</p>
                    <small>By ${post.createdBy}</small>
                    <div class="reactions">
                        <button onclick="react('${post.postID}', 'like')">üëç</button>
                        <button onclick="react('${post.postID}', 'love')">‚ù§Ô∏è</button>
                        <button onclick="react('${post.postID}', 'hate')">üëé</button>
                        <button onclick="react('${post.postID}', 'angry')">üò†</button>
                    </div>
                    <div id="comments-${post.postID}"></div>
                    <input id="comment-${post.postID}" placeholder="Add a comment">
                    <button onclick="addComment('${post.postID}')">Comment</button>
                `;
                container.appendChild(div);
                loadComments(post.postID);
                loadReactions(post.postID, 'post');
            });
        }

        async function react(targetID, type) {
            if (!currentUser) return;
            await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'addReaction',
                    userEmail: currentUser.email,
                    targetID,
                    targetType: 'post',
                    reactionType: type
                })
            });
            loadReactions(targetID, 'post');
        }

        async function addComment(postID) {
            const input = document.getElementById(`comment-${postID}`);
            const text = input.value;
            if (!text) return;
            await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'addComment',
                    userEmail: currentUser.email,
                    postID,
                    comment: text
                })
            });
            input.value = '';
            loadComments(postID);
        }

        async function loadComments(postID) {
            const response = await fetch(`${API_URL}?action=getComments&postID=${postID}`);
            const data = await response.json();
            const commentsDiv = document.getElementById(`comments-${postID}`);
            commentsDiv.innerHTML = '<h4>Comments</h4>';
            data.comments.forEach(cmt => {
                const p = document.createElement('p');
                p.textContent = `${cmt.userID}: ${cmt.comment}`;
                commentsDiv.appendChild(p);
            });
        }

        async function loadReactions(targetID, targetType) {
            const response = await fetch(`${API_URL}?action=getReactions&targetID=${targetID}&targetType=${targetType}`);
            const data = await response.json();
            // You can display counts here
        }

        window.onload = () => {
            const stored = localStorage.getItem('ntuconnect_user');
            if (stored) {
                currentUser = JSON.parse(stored);
                loadFeed();
            }
        };
    </script>
</head>
<body>
    <h1>Ntuconnect</h1>
    <div id="login">
        <input id="email" placeholder="Email">
        <input id="name" placeholder="Name">
        <button onclick="login()">Login / Register</button>
    </div>
    <div id="feed"></div>
</body>
</html>
