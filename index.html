<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NTUCONNECT</title>
<style>
body{font-family:Arial;margin:0;background:#eef1f5}
header{background:#1877f2;color:white;padding:12px;font-size:20px}
#container{display:flex}
#sidebar{width:230px;background:white;height:100vh;padding:10px}
#feed{flex:1;padding:20px}
.card{background:white;padding:12px;margin-bottom:12px;border-radius:8px}
button{padding:6px 10px;margin-top:6px}
textarea{width:100%;height:60px}
audio{width:100%}
.reactions span{cursor:pointer;margin-right:6px}
.hidden{display:none}
</style>
</head>
<body>

<header>NTUCONNECT</header>

<div id="container">

<div id="sidebar">
<b>Menu</b><br><br>
<button onclick="show('feedPage')">Home</button><br>
<button onclick="show('podcastPage')">Podcasts</button><br>
<button onclick="show('livePage')">Live</button><br>
<button onclick="show('adminPage')">Admin</button><br><br>

<button onclick="connectSpotify()">Connect Spotify</button>
</div>

<div id="feed">

<!-- HOME -->
<div id="feedPage">

<div class="card">
<textarea id="postText" placeholder="Send goodwill message..."></textarea>
<button onclick="createPost()">Post</button>
</div>

<div id="posts"></div>
</div>

<!-- PODCAST PAGE -->
<div id="podcastPage" class="hidden">

<div class="card">
<h3>Podcast Player</h3>
<audio id="player" controls></audio><br>

<button onclick="prev()">Prev</button>
<button onclick="next()">Next</button>
<button onclick="toggleLoop()">Loop</button>
<button onclick="toggleRepeat()">Repeat All</button>
</div>

<div class="card">
<input id="playlistName" placeholder="Playlist name">
<button onclick="savePlaylist()">Save Playlist</button>
</div>

<div id="podcastList"></div>
</div>

<!-- LIVE -->
<div id="livePage" class="hidden">
<div class="card">
<h3>Live Broadcast</h3>
<iframe id="liveFrame" width="100%" height="400"></iframe>
</div>
<div id="liveComments"></div>
</div>

<!-- ADMIN -->
<div id="adminPage" class="hidden">

<div class="card">
<h3>Upload Podcast</h3>
<input id="pTitle" placeholder="Title"><br>
<input id="pAudio" placeholder="Drive audio URL"><br>
<input id="pCover" placeholder="Cover URL"><br>
<button onclick="uploadPodcast()">Upload</button>
</div>

<div class="card">
<h3>Create Event</h3>
<input id="eTitle" placeholder="Event title"><br>
<input id="eDate" placeholder="Date"><br>
<button onclick="createEvent()">Create</button>
</div>

<div class="card">
<h3>Set Live Broadcast</h3>
<input id="liveIdInput" placeholder="YouTube Live ID">
<button onclick="setLive()">Start</button>
</div>

</div>

</div>
</div>

<script>
const API="PASTE_APPS_SCRIPT_URL";

/* ---------- NAVIGATION ---------- */
function show(id){
document.querySelectorAll("#feed > div").forEach(d=>d.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
}

/* ---------- POSTS ---------- */
function createPost(){
fetch(API,{
method:"POST",
body:JSON.stringify({
action:"createPost",
userId:"user1",
text:postText.value
})
}).then(()=>loadPosts());
}

function loadPosts(){
fetch(API+"?action=getPosts")
.then(r=>r.json())
.then(data=>{
posts.innerHTML="";
data.forEach(p=>{
posts.innerHTML+=`
<div class="card">
${p.text}
<div class="reactions">
<span onclick="react('${p.id}','like')">üëç</span>
<span onclick="react('${p.id}','love')">‚ù§Ô∏è</span>
<span onclick="react('${p.id}','angry')">üò°</span>
</div>
</div>`;
});
});
}

function react(id,type){
fetch(API,{
method:"POST",
body:JSON.stringify({
action:"react",
userId:"user1",
targetId:id,
type:"post",
reaction:type
})
});
}

/* ---------- PODCAST PLAYER ---------- */
let playlist=[],current=0,loop=false,repeat=false;
const player=document.getElementById("player");

function play(i){
current=i;
player.src=playlist[i].audio;
player.play();
}

player.onended=()=>{
if(loop) return play(current);
if(current<playlist.length-1) current++;
else if(repeat) current=0;
else return;
play(current);
};

function next(){ if(current<playlist.length-1) play(current+1); }
function prev(){ if(current>0) play(current-1); }
function toggleLoop(){ loop=!loop; alert("Loop:"+loop); }
function toggleRepeat(){ repeat=!repeat; alert("Repeat:"+repeat); }

/* ---------- ADMIN ---------- */
function uploadPodcast(){
fetch(API,{
method:"POST",
body:JSON.stringify({
action:"uploadPodcast",
role:"admin",
title:pTitle.value,
audioUrl:pAudio.value,
coverUrl:pCover.value,
userId:"admin1"
})
});
}

function createEvent(){
fetch(API,{
method:"POST",
body:JSON.stringify({
action:"createEvent",
role:"admin",
title:eTitle.value,
date:eDate.value
})
});
}

function setLive(){
liveFrame.src=
"https://www.youtube.com/embed/"+liveIdInput.value;
}

/* ---------- SPOTIFY ---------- */
function connectSpotify(){
location.href=
"https://accounts.spotify.com/authorize"+
"?client_id=YOUR_SPOTIFY_ID"+
"&response_type=token"+
"&redirect_uri="+encodeURIComponent(location.href)+
"&scope=streaming user-read-email";
}

loadPosts();
</script>

</body>
</html>
