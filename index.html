<!DOCTYPE html>
<html>
<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root { --primary: #004a99; --secondary: #f0f2f5; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--secondary); margin: 0; }
    .header { background: var(--primary); color: white; padding: 1rem; position: sticky; top: 0; z-index: 100; }
    .container { display: flex; max-width: 1200px; margin: auto; gap: 20px; padding: 20px; }
    .sidebar { width: 250px; background: white; border-radius: 8px; padding: 15px; height: fit-content; }
    .feed { flex: 1; }
    .card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .player-dock { position: fixed; bottom: 0; width: 100%; background: #222; color: white; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 20px; }
    .reaction-btn { border: none; background: none; cursor: pointer; font-size: 1.2rem; }
    .admin-only { display: none; background: #fff3cd; border: 1px solid #ffeeba; }
  </style>
</head>
<body>

<div class="header">
  <h1>Ntuconnect</h1>
</div>

<div class="container">
  <div class="sidebar">
    <h3>Menu</h3>
    <button onclick="showTab('feed')">Home Feed</button><br><br>
    <button onclick="showTab('podcasts')">Podcasts</button><br><br>
    <button onclick="showTab('live')">YouTube Live</button><br><br>
    <div id="adminPanel" class="admin-only">
      <h4>Admin Tools</h4>
      <button onclick="uploadContent()">Upload Content</button>
    </div>
  </div>

  <div class="feed" id="mainContent">
    <div class="card">
      <textarea id="goodwillText" placeholder="Post a goodwill message..." style="width:100%"></textarea>
      <button onclick="submitPost()">Post</button>
    </div>
    <div id="postsContainer"></div>
  </div>
</div>

<div class="player-dock">
  <span id="nowPlaying">Nothing playing</span>
  <button onclick="prevTrack()"><i class="fas fa-step-backward"></i></button>
  <button onclick="togglePlay()"><i id="playIcon" class="fas fa-play"></i></button>
  <button onclick="nextTrack()"><i class="fas fa-step-forward"></i></button>
  <button onclick="toggleLoop()"><i id="loopIcon" class="fas fa-redo"></i></button>
  <div id="spotify-player"></div>
</div>

<script>
  // App State
  let playlist = [];
  let currentIndex = 0;
  let isLooping = false;

  // Initialize App
  window.onload = () => {
    loadFeed();
    checkAdmin();
  };

  function checkAdmin() {
    google.script.run.withSuccessHandler(role => {
      if(role === 'Admin') document.getElementById('adminPanel').style.display = 'block';
    }).getUserRole();
  }

  // Podcast / Audio Logic
  function playPodcast(url, title) {
    document.getElementById('nowPlaying').innerText = "Playing: " + title;
    let audio = new Audio(url);
    audio.play();
    audio.onended = () => {
      if(isLooping) { audio.play(); } 
      else { nextTrack(); }
    };
  }

  // Spotify Integration using your Client ID 
  function loadSpotify(trackId) {
    const spotifyIframe = `<iframe src="https://open.spotify.com/embed/track/${trackId}" 
      width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`;
    document.getElementById('spotify-player').innerHTML = spotifyIframe;
  }

  // YouTube Live Integration 
  function showTab(tab) {
    const container = document.getElementById('mainContent');
    if(tab === 'live') {
      container.innerHTML = `
        <div class="card">
          <h3>Ntuconnect Live Broadcast</h3>
          <iframe width="100%" height="400" src="https://www.youtube.com/embed/live_stream?channel=YOUR_CHANNEL_ID" frameborder="0" allowfullscreen></iframe>
        </div>`;
    } else if(tab === 'feed') {
      location.reload();
    }
  }

  // Reaction Logic
  function react(postId, emoji) {
    google.script.run.withSuccessHandler(() => {
      alert("Reacted with " + emoji);
      loadFeed();
    }).toggleReaction(postId, emoji);
  }

  function loadFeed() {
    google.script.run.withSuccessHandler(data => {
      const container = document.getElementById('postsContainer');
      container.innerHTML = data.posts.map(post => `
        <div class="card">
          <p><strong>${post[1]}</strong>: ${post[3]}</p>
          <div class="reactions">
            <button class="reaction-btn" onclick="react('${post[0]}', '‚ù§Ô∏è')">‚ù§Ô∏è</button>
            <button class="reaction-btn" onclick="react('${post[0]}', 'üëç')">üëç</button>
            <button class="reaction-btn" onclick="react('${post[0]}', 'üòÆ')">üòÆ</button>
            <button class="reaction-btn" onclick="react('${post[0]}', 'üò°')">üò°</button>
          </div>
        </div>
      `).join('');
    }).getFeed();
  }
</script>
</body>
</html>
